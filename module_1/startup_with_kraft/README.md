## Установка и запуск с использованием Kraft

Это второй вариант установки Kafka. Уметь делать что-то разными способами – высший пилотаж в навыке. Потренируйтесь! .
Создадим docker-compose-файл для запуска первого узла:

Вот объяснение ключевых переменных окружения для настройки Kafka с KRaft:

- KAFKA_ENABLE_KRAFT=yes включает режим KRaft, при котором Kafka работает без Zookeeper.
- KAFKA_CFG_PROCESS_ROLE=broker,controller ― узел выполняет две роли: контроллера и брокера. Другими словам, он управляет конфигурацией, а также хранит данные и обрабатывает запросы.
- KAFKA_CFG_CONTROLLER_LISTENER_NAMES=CONTROLLER указывает слушателя для контроллера, который используется для его связи с другими узлами.
- KAFKA_CFG_CONTROLLER_QUORUM_VOTERS=0@kafka-0:9093 ― список всех контроллеров кластера с их идентификаторами, адресами и портами.
- KAFKA_KRAFT_CLUSTER_ID=somevalue ― уникальный идентификатор кластера. Значение одинаково для всех контроллеров и брокеров, его мы получим после первого запуска.
- KAFKA_CFG_LISTENERS задаёт адреса и порты, на которых Kafka принимает соединения (внутренние и внешние). Здесь мы говорим Kafka, где искать входящие запросы. В - конфигурационном файле вы указываете три слушателя: PLAINTEXT://:9092, CONTROLLER://:9093 и EXTERNAL://:9094. Первые два предназначены для внутренних - коммуникаций внутри Docker, а последний ― для внешних соединений с хост-машиной.
- KAFKA_CFG_ADVERTISED_LISTENERS ― адреса и порты, которые Kafka «рекламирует» для подключения клиентов. Клиенты Kafka должны знать, как подключиться к брокеру. - Если брокер Kafka работает внутри докер-сети, этот параметр может указывать на адрес в этой сети. Если нужно подключаться к брокеру локально, здесь указывают - соответствующий порт и протокол. В вашем конфигурационном файле вы объявляете два слушателя PLAINTEXT://kafka-0:9092 и EXTERNAL://127.0.0.1:9094. Первый - слушатель обслуживает внутренние коммуникации в Docker, второй ― внешние коммуникации с хост-машиной.
- KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP определяет, какой протокол безопасности используется для каждого типа соединений. Это помогает обеспечить безопасность данных при передаче между брокером и клиентами. В вашем конфигурационном файле вы указываете, что все слушатели (CONTROLLER, EXTERNAL, PLAINTEXT) будут использовать протокол PLAINTEXT, который не предполагает шифрования данных.
Запускаем кластер.

```
docker-compose up -d
```

2. Проверяем успешность запуска. Вводим в терминале:
```
docker ps
```

Подключим интерфейс для взаимодействия с Kafka. Добавим новый сервис в docker-compose-файл:

```
ui:
  image: provectuslabs/kafka-ui:v0.7.0
  ports:
    - "8080:8080"
  environment:
    - KAFKA_CLUSTERS_0_BOOTSTRAP_SERVERS=kafka-0:9092
    - KAFKA_CLUSTERS_0_NAME=kraft
```

Теперь по адресу http://localhost:8080 у вас доступен интерфейс для управления Kafka.
